<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reverse Storm Shear & Updraft Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background-color: #f4f4f4;
    }
    .container {
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
      text-align: center;
    }
    label {
      display: block;
      margin-top: 1rem;
    }
    input[type="number"] {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    button {
      display: block;
      width: 100%;
      padding: 0.75rem;
      background: #007acc;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
      margin-top: 1.5rem;
    }
    button:hover {
      background: #005fa3;
    }
    .result {
      margin-top: 1.5rem;
      padding: 1rem;
      background: #e9f5ff;
      border: 1px solid #b3d7ff;
      border-radius: 4px;
    }
    .formula {
      background: #eef;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      font-family: monospace;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Reverse Storm Shear & Updraft Calculator</h1>
    
    <h2>Inputs</h2>
    <label for="cape">CAPE (J/kg):</label>
    <input type="number" id="cape" placeholder="Enter CAPE (J/kg)" step="any" />

    <label for="angle">Storm Tilt Angle (θ in degrees):</label>
    <input type="number" id="angle" placeholder="Enter storm tilt angle" step="any" />

    <label for="verticalDistance">Vertical Separation (Δz in meters):</label>
    <input type="number" id="verticalDistance" placeholder="Enter vertical separation" step="any" />

    <p>
      <em>Note:</em> We assume that the low-level wind is minimal so the effective wind is due to the stronger upper-level winds.
    </p>
    
    <button id="calcButton">Calculate Parameters</button>

    <div id="result" class="result" style="display:none;">
      <p><strong>Estimated Updraft Speed (w):</strong> <span id="updraftSpeed"></span> m/s</p>
      <p><strong>Effective Advective Wind (U<sub>eff</sub>):</strong> <span id="effectiveWind"></span> m/s</p>
      <p><strong>Estimated Bulk Wind Shear (S):</strong> <span id="shear"></span> s<sup>-1</sup></p>
      <p id="explanation"></p>
    </div>
  </div>

  <script>
    // Convert degrees to radians
    function degToRad(deg) {
      return deg * (Math.PI / 180);
    }
    
    // Utility: round value to a specified number of decimals
    function round(value, decimals) {
      return Number(Math.round(value + 'e' + decimals) + 'e-' + decimals);
    }
    
    document.getElementById("calcButton").addEventListener("click", function() {
      // Retrieve input values and convert to numbers
      const cape = parseFloat(document.getElementById("cape").value);
      const angleDeg = parseFloat(document.getElementById("angle").value);
      const verticalDistance = parseFloat(document.getElementById("verticalDistance").value);
      
      // Validate inputs
      if (
        isNaN(cape) || cape < 0 ||
        isNaN(angleDeg) ||
        isNaN(verticalDistance) || verticalDistance <= 0
      ) {
        alert("Please ensure CAPE is non-negative and vertical separation is greater than 0.");
        return;
      }
      
      // 1. Estimate updraft speed using CAPE:
      //    w = sqrt(2 * CAPE)
      const updraftSpeed = Math.sqrt(2 * cape);
      
      // 2. Convert tilt angle from degrees to radians
      const angleRad = degToRad(angleDeg);
      
      // 3. Calculate effective advective wind:
      //    U_eff = w * tan(θ)
      const effectiveWind = updraftSpeed * Math.tan(angleRad);
      
      // 4. Estimate bulk wind shear:
      //    Assuming U_low ≈ 0 and a linear increase,
      //    U_high ≈ 2 * U_eff. Then shear S = U_high / Δz = (2 * U_eff) / Δz.
      const shear = (2 * effectiveWind) / verticalDistance;
      
      // Display the results
      document.getElementById("updraftSpeed").textContent = round(updraftSpeed, 2);
      document.getElementById("effectiveWind").textContent = round(effectiveWind, 2);
      document.getElementById("shear").textContent = round(shear, 4);
      
      document.getElementById("explanation").innerHTML =
        "Calculations used:<br>" +
        "<span class='formula'>w = √(2 × CAPE)</span><br>" +
        "<span class='formula'>U<sub>eff</sub> = w × tan(θ)</span><br>" +
        "<span class='formula'>Assuming U<sub>low</sub> ≈ 0, then U<sub>high</sub> ≈ 2 × U<sub>eff</sub></span><br>" +
        "<span class='formula'>S = (2 × U<sub>eff</sub>) / Δz</span>";
      
      document.getElementById("result").style.display = "block";
    });
  </script>
</body>
</html>
